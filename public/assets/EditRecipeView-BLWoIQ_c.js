import{d as M,e as c,f as V,n as P,c as a,a as e,t as E,w as N,b as T,h as f,g as y,v as b,F as _,s as C,C as X,j as O,l as G,m as H,o as r,_ as J}from"./index-C2R5qiPR.js";import{u as K}from"./recipe.store-BAoCLKIH.js";import{_ as Q}from"./AdvancedCropper.vue_vue_type_script_setup_true_lang-Cn5s0iY4.js";import{S as R}from"./sweetalert2.esm.all-BGf-Fe8G.js";const W={class:"pt-7"},Y={class:"px-4 sm:px-0"},Z={class:"text-2xl text-black dark:text-white mb-3"},ee={class:"mt-6 border-t border-t-sky-300 dark:border-t-sky-900"},te={class:"px-4 py-6 grid sm:grid-cols-3 sm:gap-4 sm:px-0 items-center grid-cols-2"},se={class:"mt-1 text-sm leading-6 text-sky-950 dark:text-sky-300 sm:mt-0"},ie={class:"px-4 py-6 sm:px-0"},oe=["src","alt"],re={class:"px-4 py-6 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0"},ne={key:0,class:"text-red-500"},le={class:"px-4 py-6 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0"},ae={class:"px-4 py-6 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0"},de=["onUpdate:modelValue"],ue=["onClick"],ce={key:0,class:"text-red-500"},pe={class:"px-4 py-6 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0"},me=["onUpdate:modelValue"],ge=["onClick"],fe={key:0,class:"text-red-500"},ye={class:"px-4 py-6 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0"},ve=["value"],be={key:0,class:"text-red-500"},xe={class:"px-4 py-6 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0"},ke=["disabled"],he={key:1},Fe=M({__name:"EditRecipeView",setup(we){const S=G(),U=H(),x=K(),D="http://localhost:3000/api",k=c(null),v=c(!1),F=c(),g=c(),h=c(),w=c(),p=c(),u=c(),t=V({title:"",description:"",ingredients:c([]),steps:c([]),image:"",category:""}),d=V({title:!1,ingredients:!1,steps:!1,category:!1});P(async()=>{p.value=U.fullPath.split("/").slice(-1)[0]??"",p.value.includes("?")&&(p.value=p.value.split("?")[0]),u.value=await $(),u.value&&(t.title=u.value.title,t.description=u.value.description,t.ingredients=u.value.ingredients.map(i=>i),t.steps=u.value.steps.map(i=>i),t.image=u.value.image,t.category=u.value.Category.id,h.value=u.value.image,F.value=x.categories)});const I=()=>{t.ingredients.push("")},j=i=>{t.ingredients.splice(i,1)},A=()=>{t.steps.push("")},L=i=>{t.steps.splice(i,1)},$=async()=>{if(p.value)try{return await x.getRecipe(p.value)}catch(i){console.error(i),R.fire("Error","Ocurrió un error al obtener la receta","error").then(()=>{S.replace("/dashboard")})}},B=i=>{const s=`${D.replace("/api","")}/no-recipe-image.jpg`;if(i){w.value=i;const n=new FileReader;n.onload=l=>{var m;const o=(m=l.target)==null?void 0:m.result;typeof o=="string"?g.value=o:g.value=s},n.readAsDataURL(i)}},q=async()=>{if(v.value=!0,!!p.value)try{if(t.title==="")return d.title=!0;if(d.title=!1,t.category==="")return d.category=!0;if(d.category=!1,t.ingredients.length<=0)return d.ingredients=!0;if(d.ingredients=!1,t.steps.length<=0)return d.steps=!0;d.steps=!1;const i=t.ingredients,s=t.steps,n=new FormData;n.append("title",t.title),n.append("description",t.description??""),n.append("categoryId",t.category),i.forEach(o=>{n.append("ingredients[]",o)}),s.forEach(o=>{n.append("steps[]",o)}),w.value&&n.append("file",w.value);const l=await x.updateRecipe(p.value,n);R.fire("Receta Actualizada","La receta ha sido actualizada correctamente","success").then(()=>{S.replace(`/dashboard/recipe/${p.value}`)})}catch(i){R.fire("Error",i,"error"),console.error(i)}finally{v.value=!1}},z=()=>{k.value&&k.value.openFileDialog()};return(i,s)=>{var n;return r(),a("div",W,[e("div",null,[e("div",Y,[e("h3",Z,"Actualizar "+E((n=u.value)==null?void 0:n.title),1)]),e("div",ee,[e("form",{class:"divide-y divide-sky-300 dark:divide-sky-900",onSubmit:N(q,["prevent"])},[e("div",te,[s[4]||(s[4]=e("dt",{class:"text-sm font-medium leading-6 text-black dark:text-white"},"Avatar",-1)),e("dd",se,[e("div",ie,[T(Q,{class:"w-full md:w-96 h-96",ref_key:"imageCropperRef",ref:k,onFileSelected:B},null,512),e("button",{onClick:z,type:"button",class:"h-36 w-36 md:h-56 md:w-56 relative flex items-center justify-center border rounded-full border-sky-950 dark:border-sky-500"},[e("div",null,[g.value||h.value?(r(),a("img",{key:0,src:g.value?g.value:h.value,alt:`${t.title}`,class:"h-36 w-36 md:h-56 md:w-56 rounded-full"},null,8,oe)):f("",!0),s[3]||(s[3]=e("span",{class:"absolute inset-0 flex items-center justify-center text-white font-semibold bg-black bg-opacity-50 rounded-full opacity-0 hover:opacity-100 transition-opacity duration-300"},"Cambiar Foto De Receta",-1))])])])])]),e("div",re,[s[5]||(s[5]=e("dt",{class:"text-sm font-medium leading-6 text-black dark:text-white"},"Título",-1)),e("div",null,[y(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>t.title=l),id:"title",name:"title",type:"text",class:"block w-full rounded-md border-0 pl-3 py-1.5 text-sky-950 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-sky-500 outline-none sm:text-sm sm:leading-6",required:""},null,512),[[b,t.title]]),d.title?(r(),a("span",ne," El título es inválido ")):f("",!0)])]),e("div",le,[s[6]||(s[6]=e("dt",{class:"text-sm font-medium leading-6 text-black dark:text-white"},"Descripción",-1)),y(e("textarea",{"onUpdate:modelValue":s[1]||(s[1]=l=>t.description=l),id:"description",name:"description",class:"block w-full rounded-md border-0 pl-3 py-1.5 text-sky-950 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-sky-500 outline-none sm:text-sm sm:leading-6",cols:"50"},null,512),[[b,t.description]])]),e("div",ae,[s[7]||(s[7]=e("dt",{class:"text-sm font-medium leading-6 text-black dark:text-white"},"Ingredientes",-1)),e("ul",null,[(r(!0),a(_,null,C(t.ingredients,(l,o)=>(r(),a("li",{key:o,class:"flex justify-center items-center gap-2"},[y(e("input",{"onUpdate:modelValue":m=>t.ingredients[o]=m,required:"",placeholder:"Escribe un ingrediente",class:"my-2 block w-full rounded-md border-0 pl-3 py-1.5 text-sky-950 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-sky-500 outline-none sm:text-sm sm:leading-6"},null,8,de),[[b,t.ingredients[o]]]),e("button",{type:"button",class:"flex-1 w-20 uppercase h-fit rounded-md border border-red-600 hover:bg-red-500 text-red-500 hover:text-red-50 px-3 py-1.5 text-sm font-semibold leading-6 shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",onClick:m=>j(o)}," X ",8,ue)]))),128)),d.ingredients?(r(),a("span",ce," Los ingredientes son obligatorios ")):f("",!0)]),e("button",{type:"button",class:"uppercase mt-5 md:my-2 w-full h-fit rounded-md border border-sky-600 hover:bg-sky-500 text-sky-500 hover:text-sky-50 px-3 py-1.5 text-sm font-semibold leading-6 shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",onClick:I}," Agregar Ingrediente ")]),e("div",pe,[s[8]||(s[8]=e("dt",{class:"text-sm font-medium leading-6 text-black dark:text-white"},"Pasos",-1)),e("ul",null,[(r(!0),a(_,null,C(t.steps,(l,o)=>(r(),a("li",{key:o,class:"flex justify-center items-center gap-2"},[y(e("input",{"onUpdate:modelValue":m=>t.steps[o]=m,required:"",placeholder:"Escribe un paso",class:"my-2 block w-full rounded-md border-0 pl-3 py-1.5 text-sky-950 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-sky-500 outline-none sm:text-sm sm:leading-6"},null,8,me),[[b,t.steps[o]]]),e("button",{type:"button",class:"flex-1 w-20 uppercase h-fit rounded-md border border-red-600 hover:bg-red-500 text-red-500 hover:text-red-50 px-3 py-1.5 text-sm font-semibold leading-6 shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",onClick:m=>L(o)}," X ",8,ge)]))),128)),d.steps?(r(),a("span",fe," Los pasos son obligatorios ")):f("",!0)]),e("button",{type:"button",class:"uppercase mt-5 md:my-2 w-full h-fit rounded-md border border-sky-600 hover:bg-sky-500 text-sky-500 hover:text-sky-50 px-3 py-1.5 text-sm font-semibold leading-6 shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",onClick:A}," Agregar Paso ")]),e("div",ye,[s[10]||(s[10]=e("dt",{class:"text-sm font-medium leading-6 text-black dark:text-white"},"Categoria",-1)),e("div",null,[y(e("select",{"onUpdate:modelValue":s[2]||(s[2]=l=>t.category=l),name:"category",id:"category",class:"block w-full rounded-md border-0 pl-3 py-1.5 text-sky-950 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-sky-500 outline-none sm:text-sm sm:leading-6",required:""},[s[9]||(s[9]=e("option",{value:""},"Seleccione una categoría",-1)),(r(!0),a(_,null,C(F.value,(l,o)=>(r(),a("option",{key:o,value:l.id},E(l.name),9,ve))),128))],512),[[X,t.category]]),d.category?(r(),a("span",be," La categoría es obligatoria ")):f("",!0)])]),e("div",xe,[e("button",{disabled:v.value,type:"submit",class:"flex w-full justify-center rounded-md bg-sky-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-sky-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},[v.value?(r(),O(J,{key:0,class:"w-6"})):(r(),a("span",he,"Actualizar Receta"))],8,ke)])],32)])])])}}});export{Fe as default};
